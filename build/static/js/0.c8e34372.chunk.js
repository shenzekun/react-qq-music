webpackJsonp([0],{166:function(e,t,s){"use strict";function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,s){function a(r,n){try{var i=t[r](n),o=i.value}catch(e){return void s(e)}if(!i.done)return Promise.resolve(o).then(function(e){a("next",e)},function(e){a("throw",e)});e(o)}return a("next")})}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function i(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=s(8),c=s.n(o),l=s(0),u=s.n(l),h=s(1),d=s.n(h),p=s(50),f=s(169),y=(s.n(f),s(51)),m=s(167),g=s(9),v=s(49),w=s(170),b=function(){function e(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,s,a){return s&&e(t.prototype,s),a&&e(t,a),t}}(),S=function(e){function t(e){r(this,t);var s=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s.handleChange=function(e){s.setState({keyword:Object(v.e)(e.target.value)})},s.enter=function(e){s.state.keyword?s.setState({isShowDelete:!0}):(s.setState({isShowDelete:!1}),s.reset()),13===e.keyCode&&(s.setState({isShowHistory:!1,isShowSearchResults:!0}),s.addHistory(s.state.keyword),s.search(s.state.keyword))},s.onClick=function(e){if(e.target.matches("#search")&&s.setState({isShowCancel:!0,isShowHistory:!0}),e.target.matches(".search-cancel")&&(s.setState({isShowCancel:!1,isShowDelete:!1,isShowHistory:!1}),s.reset()),e.target.matches(".icon-delete")&&(s.setState({isShowDelete:!1}),s.reset()),e.target.matches(".record-delete")){var t=[];localStorage.setItem("SET_HISTORY_KEY",t),s.setState({history:t})}if(e.target.matches(".icon.icon-close")){var a=s.state.history,r=a.indexOf(e.target.previousElementSibling.innerHTML);a.splice(r,1),localStorage.setItem("SET_HISTORY_KEY",a),s.setState({history:a})}(e.target.matches(".tag-keyword")||e.target.matches(".record-con"))&&s.setState({keyword:Object(v.e)(e.target.innerHTML),isShowDelete:!0,isShowCancel:!0,isShowHistory:!1,isShowSearchResults:!0},function(){s.addHistory(s.state.keyword),s.search(s.state.keyword)})},s.showPlayerDetail=function(e){console.log(e),s.props.showPlayer(),s.props.getSong(Object.assign({},e))},s.state={hotkeys:[],history:[],data:"",keyword:"",getLastKeyword:"",searchResult:[],isShowCancel:!1,isShowDelete:!1,isShowHistory:!1,isShowSearchResults:!1,fetching:!1,isLoad:!0,isGetHotKey:!1},s.songsObject={},s.page=1,s}return i(t,e),b(t,[{key:"componentDidMount",value:function(){function e(){return t.apply(this,arguments)}var t=a(c.a.mark(function e(){var t;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return window.addEventListener("scroll",this.onScroll.bind(this)),e.next=3,this.props.getHotList();case 3:t=localStorage.getItem("SET_HISTORY_KEY")?localStorage.getItem("SET_HISTORY_KEY").split(","):[],this.setState({isGetHotKey:!0,history:t}),this.props.hotkeys&&this.setState({hotkeys:this.shuffle(this.props.hotkeys.hotkey,6),data:this.props.hotkeys});case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"shuffle",value:function(e,t){for(var s=[],a=Math.min(t,e.length),r=0;r<a;r++){var n=e,i=Math.floor(Math.random()*n.length);s[r]=n[i],e.splice(i,1)}return s}},{key:"reset",value:function(){this.page=1,this.songsObject={},this.setState({searchResult:[],isLoad:!0})}},{key:"addHistory",value:function(e){if(e){var t=this.state.history;-1===t.indexOf(e)&&(t.unshift(e),localStorage.setItem("SET_HISTORY_KEY",t),console.log(t),this.setState({history:t}))}}},{key:"componentWillUnmount",value:function(){this.setState=function(e,t){},window.removeEventListener("scroll",this.onScroll.bind(this))}},{key:"search",value:function(){function e(e){return t.apply(this,arguments)}var t=a(c.a.mark(function e(t){var s,a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t=""),""!==t){e.next=3;break}return e.abrupt("return");case 3:if(this.state.getLastKeyword!==t||!this.songsObject[r||this.page]){e.next=5;break}return e.abrupt("return");case 5:if(this.state.getLastKeyword!==t&&this.reset(),!this.state.fetching&&this.state.isLoad){e.next=8;break}return e.abrupt("return");case 8:return this.setState({getLastKeyword:t}),this.loading(),e.next=12,g.d.searchList(t,r||this.page);case 12:s=e.sent,this.page=s.song.curpage,this.songsObject[this.page]=s.song.list,this.state.searchResult?(a=this.state.searchResult,this.setState({searchResult:a.concat(s.song.list)})):this.setState({searchResult:s.song.list}),this.setState({isLoad:"no results"!==s.message}),this.accomplish();case 18:case"end":return e.stop()}},e,this)}));return e}()},{key:"accomplish",value:function(){this.setState({fetching:!1})}},{key:"loading",value:function(){this.setState({fetching:!0})}},{key:"onScroll",value:function(e){if(!this.state.isLoad)return window.removeEventListener("scroll",this.onScroll.bind(this));document.documentElement.clientHeight+window.pageYOffset>document.body.scrollHeight-100&&this.search(this.state.keyword,this.page+1)}},{key:"render",value:function(){var e=this;return u.a.createElement("div",null,u.a.createElement(p.a,null),u.a.createElement("div",{className:"tab-contents"},u.a.createElement("div",{className:"search-view tab-content",onClick:this.onClick},u.a.createElement("div",{className:"search-bar"},u.a.createElement("div",{className:"input-wrap"},u.a.createElement("input",{type:"text",id:"search",placeholder:"\u641c\u7d22\u6b4c\u66f2\u3001\u6b4c\u5355\u3001\u4e13\u8f91",onChange:this.handleChange,onKeyUp:this.enter,value:this.state.keyword}),u.a.createElement("span",{className:"icon-search"}),this.state.isShowDelete?u.a.createElement("span",{className:"icon-delete"},"\u5220\u9664"):null),this.state.isShowCancel?u.a.createElement("div",{className:"search-cancel"},"\u53d6\u6d88"):null),this.state.history.length>0&&this.state.isShowHistory?u.a.createElement("div",{className:"record-keys"},this.state.history.map(function(e,t){return u.a.createElement("li",{key:t},u.a.createElement("div",{className:"record-main"},u.a.createElement("span",{className:"icon icon-clock"}),u.a.createElement("span",{className:"record-con ellipsis"},e),u.a.createElement("span",{className:"icon icon-close"})))}),u.a.createElement("p",{className:"record-delete"},"\u6e05\u9664\u641c\u7d22\u8bb0\u5f55")):null,this.state.isShowSearchResults?u.a.createElement("div",{className:"search-results"},u.a.createElement("div",{className:"song-list"},this.state.searchResult.map(function(t){return u.a.createElement("div",{className:"song-item",key:t.songid,onClick:e.showPlayerDetail.bind(e,t)},u.a.createElement("i",{className:"icon icon-music"}),u.a.createElement("div",{className:"song-name"},Object(v.d)(t.songname)),u.a.createElement("div",{className:"song-artist"},t.singer.map(function(e,t){return u.a.createElement("span",{key:t},Object(v.d)(e.name)+" ")})))})),this.state.fetching?u.a.createElement("div",{className:"search-loading show"},u.a.createElement("i",{className:"loading-icon"}),u.a.createElement("div",{className:"loading-text"},"\u6b63\u5728\u8f7d\u5165\u66f4\u591a...")):null,this.state.isLoad?null:u.a.createElement("div",{className:"search-loading show"},u.a.createElement("div",{className:"loading-done"},"\u5df2\u52a0\u8f7d\u5168\u90e8"))):null,this.state.isShowHistory||this.state.isShowSearchResults?null:u.a.createElement("div",{className:"mod-search-result",id:"hot-keys"},u.a.createElement("h3",{className:"result-tit"},"\u70ed\u95e8\u641c\u7d22"),this.state.isGetHotKey?u.a.createElement("div",{className:"result-tags"},u.a.createElement("a",{href:this.state.data.special_url,className:"tag tag-hot"},this.state.data.special_key),this.state.hotkeys.map(function(e){return u.a.createElement("div",{className:"tag tag-keyword",key:e.n},e.k)})):u.a.createElement("div",{className:"search-loading show"},u.a.createElement("i",{className:"loading-icon"}),u.a.createElement("div",{className:"loading-text"},"\u6b63\u5728\u52a0\u8f7d...")))),this.props.isShowPlayer?u.a.createElement(w.a,null):null))}}]),t}(l.Component);S.propTypes={getHotList:d.a.func.isRequired,hotkeys:d.a.object.isRequired},t.default=Object(y.b)(function(e){return{hotkeys:e.getData.hotkeys,isShowPlayer:e.getData.isShowPlayer}},{getHotList:m.b,showPlayer:m.e,getSong:m.c})(S)},167:function(e,t,s){"use strict";function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,s){function a(r,n){try{var i=t[r](n),o=i.value}catch(e){return void s(e)}if(!i.done)return Promise.resolve(o).then(function(e){a("next",e)},function(e){a("throw",e)});e(o)}return a("next")})}}s.d(t,"b",function(){return l}),s.d(t,"e",function(){return u}),s.d(t,"a",function(){return h}),s.d(t,"c",function(){return d}),s.d(t,"d",function(){return p});var r=s(8),n=s.n(r),i=s(54),o=s(9),c=this,l=function(){return function(){var e=a(n.a.mark(function e(t){var s;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.d.hotList();case 3:s=e.sent,t({type:i.b,data:s}),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}},e,c,[[0,7]])}));return function(t){return e.apply(this,arguments)}}()},u=function(){return{type:i.e,isShowPlayer:!0}},h=function(){return{type:i.a,isShowPlayer:!1}},d=function(e){return function(t){var s="";e.singer.forEach(function(e){s+=e.name}),t({type:i.c,song:e,artist:s})}},p=function(e){return{type:i.d,isPlay:e}}},169:function(e,t,s){e.exports=s.p+"static/media/search.21bc8c32.scss"},170:function(e,t,s){"use strict";function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,s){function a(r,n){try{var i=t[r](n),o=i.value}catch(e){return void s(e)}if(!i.done)return Promise.resolve(o).then(function(e){a("next",e)},function(e){a("throw",e)});e(o)}return a("next")})}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function i(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=s(8),c=s.n(o),l=s(0),u=s.n(l),h=s(1),d=s.n(h),p=s(171),f=(s.n(p),s(51)),y=s(53),m=s(49),g=s(9),v=s(167),w=function(){function e(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,s,a){return s&&e(t.prototype,s),a&&e(t,a),t}}(),b=function(e){function t(e){r(this,t);var s=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s.onPlay=function(){if(s.isplay=!s.isplay,s.isplay){if(s.state.fetching)return;s.refs.$audio.play(),s.props.setPlayState(!0),s.startLyrics(),s.startProgress()}else s.refs.$audio.pause(),s.props.setPlayState(!1),s.pauseLyrics(),s.pauseProgress()},s.exit=function(){s.props.cancelPlayer(),s.props.setPlayState(!1),document.body.classList.remove("noscroll")},s.state={fetching:!1,duration:s.props.song.interval,progressIntervalId:0,lyrics:[],index:0,progress:0,elapsed:0},s.isplay=!1,s.lyricIntervalId=0,s.LINE_HEIGHT=42,s}return i(t,e),w(t,[{key:"componentDidMount",value:function(){function e(){return t.apply(this,arguments)}var t=a(c.a.mark(function e(){var t;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return document.body.classList.add("noscroll"),this.setState({fetching:!0}),e.next=4,g.d.getLyrics(this.props.song.songid);case 4:t=e.sent,this.setState({index:0,lyrics:Object(m.d)(t.lyric).match(/^\[\d{2}:\d{2}.\d{2}\](.+)$/gm)}),this.setState({fetching:!1}),console.log(t);case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"startLyrics",value:function(){this.pauseLyrics(),this.lyricIntervalId=setInterval(this.updateLyrics.bind(this),1e3)}},{key:"pauseLyrics",value:function(){clearInterval(this.lyricIntervalId)}},{key:"updateLyrics",value:function(){var e=this;if(this.refs.$audio&&this.refs.$audio.ontimeupdate&&(this.refs.$audio.ontimeupdate=function(t){for(var s=0,a=e.state.lyrics.length;s<a;s++)e.refs.$audio.currentTime>Object(m.c)(e.state.lyrics[s])-.5&&(e.refs.$lyricsLines.children[e.state.index].classList.remove("active"),e.refs.$lyricsLines.children[s].classList.add("active"),e.state.index=s)},this.state.index>2)){var t=-(this.state.index-2)*this.LINE_HEIGHT;this.refs.$lyricsLines.style.transform="translateY("+t+"px)"}}},{key:"resetLyrics",value:function(){this.pauseLyrics(),this.refs.$lyricsLines.children[this.index].classList.remove("active"),this.setState({index:0}),this.refs.$lyricsLines.style.transform="translateY(0)",this.state.lyrics.length&&this.refs.$lyricsLines.children[this.state.index].classList.add("active")}},{key:"restartLyrics",value:function(){this.resetLyrics(),this.startLyrics()}},{key:"onEnd",value:function(){this.refs.$audio.play(),this.restartProgress(),this.restartLyrics()}},{key:"startProgress",value:function(){this.pauseProgress(),this.progressIntervalId=setInterval(this.updateProgress.bind(this),50)}},{key:"pauseProgress",value:function(){clearInterval(this.progressIntervalId)}},{key:"updateProgress",value:function(){var e=this;this.setState({elapsed:this.state.elapsed+.05},function(){e.setState({progress:e.state.elapsed/e.state.duration})}),this.refs.$progress.style.transform="translateX("+(100*this.state.progress-100)+"%)"}},{key:"resetProgress",value:function(e){this.pauseProgress();this.setState({elapsed:0,progress:0}),this.refs.$progress.style.transform="translate(-100%)",e&&this.setState({duration:+e})}},{key:"restartProgress",value:function(){this.resetProgress(),this.startProgress()}},{key:"componentWillUnmount",value:function(){this.pauseLyrics(),this.pauseProgress(),this.setState=function(e,t){}}},{key:"render",value:function(){return u.a.createElement("div",{id:"player",className:"show"},u.a.createElement("div",{className:"player-container"},u.a.createElement("div",{className:"player-header"},u.a.createElement("img",{src:Object(y.a)(this.props.song.albummid),alt:"\u56fe\u7247",className:"album-cover"}),u.a.createElement("div",{className:"song-info"},u.a.createElement("div",{className:"song-name"},Object(m.d)(this.props.song.songname)),u.a.createElement("div",{className:"song-artist"},Object(m.d)(this.props.artist))),u.a.createElement("span",{className:this.props.isPlay?"icon-action icon-play icon-pause":"icon-action icon-play icon-play",onClick:this.onPlay})),u.a.createElement("div",{className:"player-lyrics"},u.a.createElement("div",{className:"player-lyrics-lines",ref:"$lyricsLines"},0!==this.state.lyrics?this.state.lyrics.map(function(e,t){return u.a.createElement("div",{className:"player-lyrics-line",key:t},e.slice(10))}):null,this.state.fetching?u.a.createElement("div",{className:"player-lyrics-line"},"\u6b63\u5728\u52a0\u8f7d\u6b4c\u8bcd,\u8bf7\u7b49\u5f85..."):null)),u.a.createElement("div",{className:"player-footer"},u.a.createElement("div",{className:"icon-list",onClick:this.exit}),u.a.createElement("div",{className:"progress"},u.a.createElement("div",{className:"progress-time progress-elapsed"},Object(m.b)(this.state.elapsed)),u.a.createElement("div",{className:"progress-bar"},u.a.createElement("div",{className:"progress-bar-progress",ref:"$progress"})),u.a.createElement("div",{className:"progress-time progress-duration"},Object(m.b)(this.props.song.interval))),u.a.createElement("div",{className:"action"},u.a.createElement("a",{href:"#",className:"btn-download"},"\u4e0b\u8f7d\u8fd9\u9996\u6b4c")))),u.a.createElement("div",{className:"player-background",style:{backgroundImage:"url("+Object(y.a)(this.props.song.albummid)+")"}}),u.a.createElement("audio",{src:Object(y.d)(this.props.song.songmid),ref:"$audio",onEnded:this.onEnd}))}}]),t}(l.Component);b.propTypes={song:d.a.object.isRequired,artist:d.a.string.isRequired,isPlay:d.a.bool.isRequired},t.a=Object(f.b)(function(e){return{song:e.getData.song,artist:e.getData.artist,isPlay:e.getData.isPlay}},{setPlayState:v.d,cancelPlayer:v.a})(b)},171:function(e,t,s){e.exports=s.p+"static/media/player.753dd1f0.scss"}});
//# sourceMappingURL=0.c8e34372.chunk.js.map